(define (mem message proc)
  (define mem-table (make-table))
  (define memoize
    (lambda (k)
      (if (not (lookup k mem-table))ear
        (insert! k (proc k) mem-table)
        (lookup k mem-table))))
  (define unmemoize '())
  (define (dispatch message proc)
    (cond
      ((eq? message 'memoize) memoize)
      ((eq? message 'unmemoize) unmemoize))))

(set! fib (mem 'memoize fib))
(fib 3)
(fib 2)
